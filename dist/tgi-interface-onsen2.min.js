(function(){"use strict";function t(e,r){var n;if(!1==this instanceof t)throw new Error("new operator required");if("string"==typeof e){var i=e;e={},e.name=i,"string"==typeof r&&(e.type=r)}e=e||{},this.name=e.name||null,this.label=e.label||e.name,this.label&&(this.label=this.label.charAt(0).toUpperCase()+this.label.slice(1)),this.type=e.type||"String",n=function(t){var e=t.split("(");return e[1]=parseInt(e[1]),e}(this.type),this.type=n[0],this.hint=e.hint||{},void 0!==e.hidden&&(this.hidden=e.hidden),this.validationRule=e.validationRule||{};var o=[],s=["name","type","label","hint","hidden","value","validationRule"];switch(this.type){case"ID":o=M(e,s),this.value=e.value||null;break;case"String":o=M(e,s.concat(["placeHolder","quickPick","size"])),this.size=n[1]?n[1]:"number"==typeof e.size?e.size:e.size||50,this.value=e.value||null,e.quickPick&&(this.quickPick=e.quickPick),this.placeHolder=e.placeHolder||null;break;case"Date":o=M(e,s.concat("placeHolder")),this.value=e.value||null,this.placeHolder=e.placeHolder||null;break;case"Boolean":o=M(e,s),e.value===!1?this.value=!1:this.value=e.value||null;break;case"Number":o=M(e,s.concat("placeHolder")),0===e.value?this.value=0:this.value=e.value||null,this.placeHolder=e.placeHolder||null;break;case"Model":o=M(e,s),this.value=e.value||null,this.value instanceof t.ModelID&&(this.modelType=this.value.modelType);break;case"Group":o=M(e,s),this.value=e.value||null;break;case"Table":o=M(e,s.concat("group")),this.value=e.value||null,this.group=e.group||null;break;case"Object":o=M(e,s),this.value=e.value||null}for(var a=this.getObjectStateErrors(),c=0;c<o.length;c++)a.push("invalid property: "+o[c]);if(a.length>1)throw new Error("error creating Attribute: multiple errors");if(a.length)throw new Error("error creating Attribute: "+a[0]);this._eventListeners=[],this._errorConditions={}}function e(t){if(!1==this instanceof e)throw new Error("new operator required");"function"==typeof t&&(t={type:"Function",contents:t}),t instanceof d&&(t={type:"Procedure",contents:t}),t=t||{};var r,n=M(t,["name","description","type","contents","scope","timeout","theme","icon","bucket","presentationMode","location","images"]),i=[];for(r=0;r<n.length;r++)i.push("invalid property: "+n[r]);if(i.length>1)throw new Error("error creating Command: multiple errors");if(i.length)throw new Error("error creating Command: "+i[0]);for(r in t)this[r]=t[r];if(this.name=this.name||"a command","string"!=typeof this.name)throw new Error("name must be string");if("undefined"==typeof this.description&&(this.description=this.name+" Command"),"undefined"==typeof this.type&&(this.type="Stub"),!q(e.getTypes(),this.type))throw new Error("Invalid command type: "+this.type);switch(this.type){case"Stub":break;case"Menu":if(!(this.contents instanceof Array))throw new Error("contents must be array of menu items");if(!this.contents.length)throw new Error("contents must be array of menu items");for(r in this.contents)if(this.contents.hasOwnProperty(r)&&"string"!=typeof this.contents[r]&&!(this.contents[r]instanceof e))throw new Error("contents must be array of menu items");break;case"Presentation":if(!(this.contents instanceof g))throw new Error("contents must be a Presentation");if(this.presentationMode=this.presentationMode||"View",!q(e.getPresentationModes(),this.presentationMode))throw new Error("Invalid presentationMode: "+this.presentationMode);break;case"Function":if("function"!=typeof this.contents)throw new Error("contents must be a Function");break;case"Procedure":if(!(this.contents instanceof d))throw new Error("contents must be a Procedure");break;default:throw new TypeError}if("undefined"!=typeof this.scope&&!(this.scope instanceof f||this.scope instanceof p))throw new Error("optional scope property must be Model or List");if("undefined"!=typeof this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.timeout&&"number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.theme){if("string"!=typeof this.theme)throw new Error("invalid theme");if(!q(["default","primary","success","info","warning","danger","link"],this.theme))throw new Error("invalid theme")}if("undefined"!=typeof this.icon){if("string"!=typeof this.icon)throw new Error("invalid icon");if(!q(["fa","glyphicon"],this.icon.split("-")[0])||!this.icon.split("-")[1])throw new Error("invalid icon")}this._eventListeners=[]}function r(e){if(!1==this instanceof r)throw new Error("new operator required");if(!1==e instanceof t.ModelID)throw new Error("Attribute.ModelID required in constructor");this.dateCreated=new Date,this.modelID=e,this.attributeValues={}}function n(t){if(!1==this instanceof n)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a Interface",t.vendor=t.vendor||null;var e,r=M(t,["name","description","vendor"]),i=[];for(e=0;e<r.length;e++)i.push("invalid property: "+r[e]);if(i.length>1)throw new Error("error creating Interface: multiple errors");if(i.length)throw new Error("error creating Interface: "+i[0]);this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1;for(e in t)this[e]=t[e]}function i(t,e){if(!1==this instanceof i)throw new Error("new operator required");if("undefined"==typeof t)throw new Error("message type required");if(!q(i.getTypes(),t))throw new Error("Invalid message type: "+t);this.type=t,this.contents=e}function o(t){if(!1==this instanceof o)throw new Error("new operator required");if("string"==typeof t){var r=t;t={},t.type=r}if(t=t||{},this.type=t.type||null,t.value&&(this.value=t.value),!this.type||"string"!=typeof this.type)throw new Error("Request type required");switch(this.type){case"Command":if(this.command=t.command||null,!(this.command instanceof e))throw new Error("command object required")}}function s(t){if(!1==this instanceof s)throw new Error("new operator required");this.contents=t||"",this._eventListeners=[]}function a(t,e){if(!1==this instanceof a)throw new Error("new operator required");if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");var r=this;r.connected=!1,r.initialConnect=!0,r.location=t,""===r.location&&(r.location="http host"),r.socket=io.connect(t,{reconnection:!1}),r.socket.on("connect",function(){r.connected=!0,r.initialConnect=!1,console.log("socket.io ("+r.location+") connected"),e.call(r,new i("Connected",""))}),r.socket.on("connecting",function(){console.log("socket.io ("+r.location+") connecting")}),r.socket.on("error",function(t){var n="general error with "+r.location+(t?", reason "+t:"");console.error(n),r.initialConnect&&e.call(r,new i("Error",n))}),r.socket.on("connect_error",function(t){var n="connect error with "+r.location+(t?", reason "+t:"");console.error(n),r.initialConnect&&e.call(r,new i("Error",n))}),r.socket.on("connect_failed",function(t){var n="connect failed with "+r.location+(t?", reason "+t:"");console.error(n),r.initialConnect&&e.call(r,new i("Error",n))}),r.socket.on("message",function(t){r.rawCallBack?r.rawCallBack(t):console.log("socket.io ("+r.location+") message: "+t)}),r.socket.on("disconnect",function(t){r.connected=!1,console.log("socket.io ("+r.location+") disconnect: "+t)})}function c(e,r,n){if(!1==this instanceof c)throw new Error("new operator required");if(!(e instanceof f))throw new Error("argument must be a Model");if("object"!=typeof r)throw new Error("object expected");if(!(n instanceof Array))throw new Error("array of attributes expected");this.primaryModel=e,this.relatedModels=r,this.attributes=n;var i=new t("id","ID");i.model=e,this.attributes.unshift(i);for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];if("object"!=typeof s)throw new Error("relatedModel key values expect object");if(void 0===s.id)throw new Error("relatedModel key values expect object with id key");if(void 0===s.model)throw new Error("relatedModel key values expect object with model key");if(!(s.id instanceof t))throw new Error("relatedModel id must be a Attribute");if(!(s.model instanceof f))throw new Error("relatedModel model must be a Model")}for(var a=0;a<n.length;a++){var l=n[a];if(!(l instanceof t))throw new Error("attribute array must contain Attributes");if(!(l.model instanceof f))throw new Error("attribute array must contain Attributes with model references")}}function l(e){if(!1==this instanceof l)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]);var r=new t.ModelID(new E);e.attributes.push(new t({name:"user",type:"Model",value:r})),e.attributes.push(new t({name:"deltas",type:"Object",value:{}})),f.call(this,e),this.modelType="Workspace"}var h=this,u={CORE:function(){return{version:"0.4.47",Application:w,Attribute:t,Command:e,Delta:r,Interface:n,List:p,Log:y,MemoryStore:k,Message:i,Model:f,Presentation:g,Procedure:d,REPLInterface:v,Request:o,Session:b,Store:m,Text:s,Transport:a,User:E,View:c,Workspace:l,inheritPrototype:P,getInvalidProperties:M,getConstructorFromModelType:_,createModelFromModelType:C,getObjectFromCPON:x,trim:O,ltrim:L,rtrim:A,left:I,center:T,right:S,lpad:R,rpad:D,cpad:N,contains:q}}};t.ModelID=function(e){if(!1==this instanceof t.ModelID)throw new Error("new operator required");if(!1==e instanceof f)throw new Error("must be constructed with Model");var r=e.getShortName();r&&(this.name=r),this.value=e.get("id"),this.constructorFunction=e.constructor,this.modelType=e.modelType},t.ModelID.prototype.toString=function(){return this.name?this.modelType+" "+this.name:this.modelType+" "+this.value},t.prototype.toString=function(){return null===this.name?"new Attribute":"Attribute: "+this.name+" = "+this.value},t.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!q(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},t.prototype.offEvent=function(){this._eventListeners=[]},t.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||q(r.events,t))&&r.callback.call(this,t)}},t.prototype.get=function(){return this.value},t.prototype.set=function(e){switch(this.type){case"Model":if(!(e instanceof t.ModelID))throw new Error("set error: value must be Attribute.ModelID");this.value=e;break;default:this.value=e}return this._emitEvent("StateChange"),this.value},t.prototype.coerce=function(t){var e,r=t;switch(this.type){case"String":return"undefined"==typeof r?"":"boolean"!=typeof r||r?r?(r=t.toString(),r.length>this.size?r.substring(0,this.size):r):"":"false";case"Number":return"undefined"==typeof r?0:r?("string"==typeof r?(r=r.replace(/^\s+|\s+$/g,""),e=r.split(" "),r=e.length?e[0]:"",r=Number(r.replace(/[^\/0-9\ \.]+/g,""))):r=Number(r),r?r:0):0;case"Boolean":return"undefined"!=typeof r&&("string"==typeof r?(r=r.toUpperCase(),"Y"===r||"YES"===r||"T"===r||"TRUE"===r||"1"===r):!!r);case"Date":return"string"==typeof r&&2==r.split("/").length&&(r=r+"/"+(new Date).getFullYear()),new Date(r)}throw Error("coerce cannot determine appropriate value")},t.prototype.getObjectStateErrors=function(){var e;switch(this.validationErrors=[],this.name||this.validationErrors.push("name required"),q(["ID","String","Date","Boolean","Number","Model","Group","Table","Object"],this.type)||this.validationErrors.push("Invalid type: "+this.type),this.type){case"ID":break;case"String":"number"!=typeof this.size&&this.validationErrors.push("size must be a number from 1 to 255"),(this.size<1||this.size>255)&&this.validationErrors.push("size must be a number from 1 to 255"),null!==this.value&&"string"!=typeof this.value&&this.validationErrors.push("value must be null or a String");break;case"Date":null===this.value||this.value instanceof Date||this.validationErrors.push("value must be null or a Date");break;case"Boolean":null!==this.value&&"boolean"!=typeof this.value&&this.validationErrors.push("value must be null or a Boolean");break;case"Number":null!==this.value&&"number"!=typeof this.value&&this.validationErrors.push("value must be null or a Number");break;case"Model":this.value instanceof t.ModelID||this.validationErrors.push("value must be Attribute.ModelID");break;case"Group":if(null===this.value||this.value instanceof Array)for(e in this.value)this.value.hasOwnProperty(e)&&(this.value[e]instanceof t||this.validationErrors.push("each element in group must be instance of Attribute"),this.value[e].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("value must be null or an array");break;case"Table":if(this.group instanceof t)if(this.group.value instanceof Array)if(this.group.value.length<1)this.validationErrors.push("group property value must contain at least one Attribute");else for(e in this.group.value)this.group.value.hasOwnProperty(e)&&(this.group.value[e]instanceof t||this.validationErrors.push("each element in group must be instance of Attribute"),this.group.value[e].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("group.value must be an array");else this.validationErrors.push("group property required")}var r=M(this.validationRule,["required","range","isOneOf","isValidModel"]);return r.length&&this.validationErrors.push("invalid validationRule: "+r),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},t.prototype.validate=function(t){if("function"!=typeof t)throw new Error("callback is required");this.getObjectStateErrors(),this._emitEvent("Validate");var e;for(e in this._errorConditions)this._errorConditions.hasOwnProperty(e)&&this.validationErrors.push(this._errorConditions[e]);this.validationRule.required&&!this.value&&("Number"==this.type?0!==this.value&&this.validationErrors.push(this.label+" required"):"Boolean"==this.type?this.value!==!1&&this.validationErrors.push(this.label+" required"):this.validationErrors.push(this.label+" required")),this.validationRule.range&&(this.validationRule.range instanceof Array||(this.validationRule.range=[this.validationRule.range]),(this.validationRule.range[0]||0===this.validationRule.range[0])&&this.value<this.validationRule.range[0]&&this.validationErrors.push(this.label+" must be at least "+this.validationRule.range[0]),(this.validationRule.range[1]||0===this.validationRule.range[1])&&this.value>this.validationRule.range[1]&&this.validationErrors.push(this.label+" must be no more than "+this.validationRule.range[1])),this.validationRule.isOneOf&&(this.validationRule.isOneOf instanceof Array||(this.validationRule.isOneOf=[this.validationRule.isOneOf]),this.validationRule.isOneOf.indexOf(this.value)==-1&&this.validationErrors.push(this.label+" invalid")),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this._emitEvent("StateChange"),t.call(this)},t.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},t.prototype.clearError=function(t){if(t=t||"",!t)throw new Error("condition required");delete this._errorConditions[t]},t.getTypes=function(){return["ID","String","Date","Boolean","Number","Model","Group","Table","Object"].slice(0)},t.getEvents=function(){return["StateChange","Validate"].slice(0)},e.prototype.toString=function(){return this.type+" Command: "+this.name},e.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!q(["BeforeExecute","AfterExecute","Error","Aborted","Completed"],t[r]))throw new Error("Unknown command event: "+t[r]);this._eventListeners.push({events:t,callback:e})},e.prototype._emitEvent=function(t,e){var r;for(r in this._eventListeners)if(this._eventListeners.hasOwnProperty(r)){var n=this._eventListeners[r];(n.events.length&&"*"===n.events[0]||q(n.events,t))&&n.callback.call(this,t,e)}},e.prototype.execute=function(t){function r(){a.status=0;try{a.contents.apply(a,c)}catch(t){a.error=t,a._emitEvent("Error",t),a._emitEvent("Completed"),a.status=-1}}function i(){a.status=0;for(var t=a.contents.tasks||[],r=0;r<t.length;r++){if("function"==typeof t[r]){var n=t[r];t[r]={requires:[-1],command:new e({type:"Function",contents:n})}}t[r].command._parentProcedure||(t[r].command._taskIndex=r,t[r].command._parentProcedure=a,t[r].command.onEvent("*",s)),t[r].command.status=void 0}o()}function o(){for(var t=a.contents.tasks||[],e=0;e<t.length;e++){var r=!0;if("undefined"==typeof t[e].command.status){for(var n in t[e].requires){if("string"==typeof t[e].requires[n])for(var i=0;i<t.length;i++)t[i].label==t[e].requires[n]&&(!t[i].command.status||t[i].command.status<=0)&&(r=!1);if("number"==typeof t[e].requires[n])if(t[e].requires[n]==-1)"0"!=e&&(!t[e-1].command.status||t[e-1].command.status<=0)&&(r=!1);else{var o=t[e].requires[n];(!t[o].command.status||t[o].command.status<=0)&&(r=!1)}}r&&t[e].command.execute()}}}function s(t,e){var r=a.contents.tasks,n=!0;switch(t){case"Error":a._emitEvent("Error",e);break;case"Aborted":a.abort();break;case"Completed":for(var i in r)r.hasOwnProperty(i)&&(r[i].command.status&&0!==r[i].command.status||(n=!1));n?a.complete():o()}}var a=this,c=arguments;if(!a.type)throw new Error("command not implemented");if(!q(["Function","Procedure","Menu","Presentation"],a.type))throw new Error("command type "+a.type+" not implemented");var l;switch(a.type){case"Presentation":if(!(a.contents instanceof g))throw new Error("contents must be a Presentation");if(l=a.contents.getObjectStateErrors(),l.length)throw l.length>1?new Error("error executing Presentation: multiple errors"):new Error("error executing Presentation: "+l[0]);if(!(t instanceof n))throw new Error("interface param required")}a._emitEvent("BeforeExecute");try{switch(a.type){case"Function":setTimeout(r,0);break;case"Procedure":setTimeout(i,0);break;case"Menu":t.render(a,"View");break;case"Presentation":a.contents.preRenderCallback?a.contents.preRenderCallback(a,function(){t.render(a)}):t.render(a)}}catch(h){a.error=h,a._emitEvent("Error",h),a._emitEvent("Completed"),a.status=-1}a._emitEvent("AfterExecute")},e.prototype.abort=function(){this._emitEvent("Aborted"),this.status=-1,this._emitEvent("Completed")},e.prototype.complete=function(){this.status=1,this._emitEvent("Completed")},e.prototype.restart=function(){this.status=void 0,this._emitEvent("Restarted"),this.execute()},e.getTypes=function(){return["Stub","Menu","Presentation","Function","Procedure"].slice(0)},e.getEvents=function(){return["BeforeExecute","AfterExecute","Error","Aborted","Completed"].slice(0)},e.getPresentationModes=function(){return["View","Edit","List"].slice(0)},n.prototype.toString=function(){return this.description},n.prototype.canMock=function(){return!0},n.prototype.doMock=function(){var t,e;if(this.mockPending=!1,!(this.mocks.length<1)){var r=this.mocks.shift();if("ok"==r.type)return void(this.okcallback?(t=this.okcallback,delete this.okcallback,t()):this.okPending=!0);if("yes"==r.type||"no"==r.type||"cancel"==r.type){switch(r.type){case"yes":e=!0;break;case"no":e=!1;break;case"cancel":e=void 0}return void(this.yesnocallback?(t=this.yesnocallback,delete this.yesnocallback,t(e)):(this.yesnoPending=!0,this.yesnoResponse=e))}if("ask"==r.type)return void(this.askcallback?(t=this.askcallback,delete this.askcallback,t(r.value)):(this.askPending=!0,this.askResponse=r.value));if("choose"==r.type)return void(this.choosecallback?(t=this.choosecallback,delete this.choosecallback,t(n.firstMatch(r.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=r.value));this.dispatch(r),this.mockPending=!0;var i=this;setTimeout(function(){i.doMock()},0)}},n.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof o))throw new Error("missing request parameter");t instanceof Array||(t=[t]);var e;for(e=0;e<t.length;e++)if(!1==t[e]instanceof o)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},n.prototype.start=function(t,e,r){if(!(t instanceof w))throw new Error("Application required");if(!(e instanceof g))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callback required");this.application=t,this.presentation=e,this.startcallback=r},n.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callback required")},n.prototype.dispatch=function(t,e){if(!1==t instanceof o)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startcallback&&this.startcallback(t)},n.prototype.notify=function(t){if(!1==t instanceof i)throw new Error("Message required")},n.prototype.render=function(t,r){if(!1==t instanceof e)throw new Error("Command object required")},n.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},n.prototype.done=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},n.prototype.warn=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},n.prototype.err=function(t){if(!t||"string"!=typeof t)throw new Error("text required")},n.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.okPending?(delete this.okPending,e()):this.okcallback=e},n.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnocallback=e},n.prototype.ask=function(e,r,n){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("attribute or callback expected");if("function"!=typeof n)throw new Error("callback required");this.askPending?(delete this.askPending,n(this.askResponse)):this.askcallback=n},n.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.choosePending?(delete this.choosePending,r(n.firstMatch(this.chooseResponse,e))):(this.choosecallback=r,this.chooseChoices=e)},n.firstMatch=function(t,e){if(void 0!==t)for(var r=0;r<e.length;r++){var n=e[r].toLowerCase();if(I(n,t.length)==t.toLowerCase())return r}};var p=function(t){if(!1==this instanceof p)throw new Error("new operator required");if(t instanceof f)this.model=t;else{if(!(t instanceof c))throw new Error("argument required: model");this.view=t,this.model=this.view.primaryModel}this.attributes=t.attributes,this._items=[],this._itemIndex=-1};p.prototype.length=function(){return this._items.length},p.prototype.clear=function(){return this._items=[],this._itemIndex=-1,this},p.prototype.get=function(t){if(this._items.length<1)throw new Error("list is empty");for(var e=0;e<this.attributes.length;e++){var r=this.attributes[e].name.toUpperCase(),n=t.toUpperCase(),i=n.split("."),o=r==n;if(2==i.length){n=i[1];var s=i[0],a=this.attributes[e].model.modelType.toUpperCase();o=r==n&&s==a}if(o)return"Date"!=this.attributes[e].type||this._items[this._itemIndex][e]instanceof Date?this._items[this._itemIndex][e]:null===this._items[this._itemIndex][e]||void 0===this._items[this._itemIndex][e]?null:new Date(this._items[this._itemIndex][e])}},p.prototype.set=function(t,e){if(this._items.length<1)throw new Error("list is empty");for(var r=0;r<this.attributes.length;r++){var n=this.attributes[r].name.toUpperCase(),i=t.toUpperCase(),o=i.split("."),s=n==i;if(2==o.length){i=o[1];var a=o[0],c=this.attributes[r].model.modelType.toUpperCase();s=n==i&&a==c}if(s)return void(this._items[this._itemIndex][r]=e)}throw new Error("attribute not valid for list model")},p.prototype.addItem=function(t){var e,r=[];if(t)for(e in t.attributes)r.push(t.attributes[e].value);else for(e in this.attributes)r.push(void 0);return this._items.push(r),this._itemIndex=this._items.length-1,this},p.prototype.removeItem=function(){return this._items.splice(this._itemIndex,1),this._itemIndex--,this},p.prototype.findItemByID=function(t){for(var e=this.moveFirst();e;){if(t==this._items[this._itemIndex][0])return!0;e=this.moveNext()}return!1},p.prototype.indexedItem=function(t){return!(this._items.length<1)&&(!(t<0)&&(!(t>=this._items.length)&&(this._itemIndex=t,!0)))},p.prototype.moveNext=function(){return!(this._items.length<1)&&this.indexedItem(this._itemIndex+1)},p.prototype.movePrevious=function(){return!(this._items.length<1)&&this.indexedItem(this._itemIndex-1)},p.prototype.moveFirst=function(){return!(this._items.length<1)&&this.indexedItem(0)},p.prototype.moveLast=function(){return!(this._items.length<1)&&this.indexedItem(this._items.length-1)},p.prototype.sort=function(t){var e,r=0;for(var n in t)e||(e=n);if(!e)throw new Error("sort order required");for(var i=1==t[e];r<this.attributes.length&&this.attributes[r].name!=e;)r++;this._items.sort(function(t,e){if(i){if(t[r]<e[r])return-1;if(t[r]>e[r])return 1}else{if(t[r]>e[r])return-1;if(t[r]<e[r])return 1}return 0})},i.prototype.toString=function(){switch(this.type){case"Null":return this.type+" Message";default:return this.type+" Message: "+this.contents}},i.getTypes=function(){return["Null","Connected","Error","Sent","Ping","PutModel","PutModelAck","GetModel","GetModelAck","DeleteModel","DeleteModelAck","GetList","GetListAck"].slice(0)};var f=function(e){var r;if(!1==this instanceof f)throw new Error("new operator required");if(this.attributes=[new t("id","ID")],e=e||{},this.modelType=e.modelType||"Model",e.attributes)for(r in e.attributes)e.attributes.hasOwnProperty(r)&&this.attributes.push(e.attributes[r]);var n=M(e,["modelType","attributes"]),i=this.getObjectStateErrors();for(r=0;r<n.length;r++)i.push("invalid property: "+n[r]);if(i.length>1)throw new Error("error creating Model: multiple errors");if(i.length)throw new Error("error creating Model: "+i[0]);for(this._eventListeners=[],this._errorConditions={},r=0;r<this.attributes.length;r++)this.attributes[r].model=this};f._ModelConstructor={},f.prototype.toString=function(){return"a "+this.modelType},f.prototype.copy=function(t){for(var e=0;e<this.attributes.length;e++)this.attributes[e].value=t.attributes[e].value},f.prototype.getObjectStateErrors=function(){if(this.validationErrors=[],this.attributes instanceof Array)if(this.attributes.length<1)this.validationErrors.push("attributes must not be empty");else for(var e=0;e<this.attributes.length;e++)0!==e||this.attributes[e]instanceof t&&"ID"==this.attributes[e].type||this.validationErrors.push("first attribute must be ID"),this.attributes[e]instanceof t||this.validationErrors.push("attribute must be Attribute");else this.validationErrors.push("attributes must be Array");return void 0===this.tags||this.tags instanceof Array||this.validationErrors.push("tags must be Array or null"),this.validationErrors},f.prototype.attribute=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e];throw new Error("attribute not found in model: "+t)},f.prototype.get=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].get()},f.prototype.getShortName=function(){for(var t=0;t<this.attributes.length;t++)if("String"==this.attributes[t].type)return this.attributes[t].get();return""},f.prototype.getLongName=function(){return this.getShortName()},f.prototype.getAttributeType=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name.toUpperCase()==t.toUpperCase())return this.attributes[e].type},f.prototype.set=function(t,e){for(var r=0;r<this.attributes.length;r++)if(this.attributes[r].name.toUpperCase()==t.toUpperCase())return this.attributes[r].set(e),void this._emitEvent("StateChange");throw new Error("attribute not valid for model")},f.prototype.validate=function(t){var e,r,n=this,i=0;if("function"!=typeof t)throw new Error("callback is required");n.getObjectStateErrors();for(r in n._errorConditions)n._errorConditions.hasOwnProperty(r)&&n.validationErrors.push(n._errorConditions[r]);if(n.validationErrors.length)return n.validationMessage=n.validationErrors.length>0?n.validationErrors[0]:"",n._emitEvent("StateChange"),void t.call(n);for(e=0;e<n.attributes.length;e++)i++,function(e){setTimeout(function(){e.validate(function(){e.validationErrors.length&&n.validationErrors.push("bush"),0===--i&&(n.validationErrors.length||n._emitEvent("Validate"),n.validationMessage=n.validationErrors.length>0?n.validationErrors[0]:"",n._emitEvent("StateChange"),t.call(n))})},0)}(n.attributes[e])},f.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!q(["StateChange","Validate"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},f.prototype._emitEvent=function(t,e){var r;for(r in this._eventListeners)if(this._eventListeners.hasOwnProperty(r)){var n=this._eventListeners[r];(n.events.length&&"*"===n.events[0]||q(n.events,t))&&n.callback.call(this,t,e)}},f.prototype.setError=function(t,e){if(t=t||"",e=e||"",!t)throw new Error("condition required");if(!e)throw new Error("description required");this._errorConditions[t]=e},f.prototype.clearError=function(t){if(t=t||"",!t)throw new Error("condition required");delete this._errorConditions[t]};var d=function(t){if(!1==this instanceof d)throw new Error("new operator required");t instanceof Array&&(t={tasks:t}),t=t||{};var e,r=M(t,["tasks","tasksNeeded","tasksCompleted"]),n=[];for(e=0;e<r.length;e++)n.push("invalid property: "+r[e]);if(n.length>1)throw new Error("error creating Procedure: multiple errors");if(n.length)throw new Error("error creating Procedure: "+n[0]);for(e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);if(n=this.getObjectStateErrors()){if(n.length>1)throw new Error("error creating Procedure: multiple errors");if(n.length)throw new Error("error creating Procedure: "+n[0])}};d.prototype.getObjectStateErrors=function(){var t,r,n,i;if(this.tasks&&!(this.tasks instanceof Array))return["tasks is not an array"];var o=[];for(t in this.tasks)if(this.tasks.hasOwnProperty(t)){var s=this.tasks[t];for(i=M(s,["label","command","requires","timeout"]),r=0;r<i.length;r++)o.push("invalid task["+t+"] property: "+i[r]);"undefined"!=typeof s.label&&"string"!=typeof s.label&&o.push("task["+t+"].label must be string"),"undefined"==typeof s.command||s.command instanceof e||o.push("task["+t+"].command must be a Command object"),"undefined"==typeof s.requires&&(s.requires=-1),s.requires instanceof Array||(s.requires=[s.requires]);for(r in s.requires)if(s.requires.hasOwnProperty(r)&&null!==s.requires[r])switch(typeof s.requires[r]){case"string":var a=!1;for(n=0;!a&&n<this.tasks.length;n++)s.requires[r]==this.tasks[n].label&&(a=!0);if(!a)throw new Error("missing label: "+s.requires[r]);break;case"number":if(s.requires[r]>=this.tasks.length)throw new Error("missing task #"+s.requires[r]+" for requires in task["+t+"]");if(s.requires[r]<-1)throw new Error("task #"+s.requires[r]+" invalid requires in task["+t+"]");break;default:throw new Error("invalid type for requires in task["+t+"]");
}}return o.length?o:null},o.prototype.toString=function(){switch(this.type){case"Command":return this.type+" Request: "+this.command;default:return this.type+" Request"}};var m=function(t){if(!1==this instanceof m)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"Store",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:!1,canPutModel:!1,canDeleteModel:!1,canGetList:!1};for(var e=M(t,["name","storeType"]),r=[],n=0;n<e.length;n++)r.push("invalid property: "+e[n]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};m.prototype.toString=function(){return this.name=="a "+this.storeType?this.name:this.storeType+": "+this.name},m.prototype.getServices=function(){return this.storeProperty},m.prototype.onConnect=function(t,e){if("string"!=typeof t)throw new Error("argument must a url string");if("function"!=typeof e)throw new Error("argument must a callback");e(this,void 0)},m.prototype.getModel=function(){throw new Error(this.storeType+" does not provide getModel")},m.prototype.putModel=function(){throw new Error("Store does not provide putModel")},m.prototype.deleteModel=function(){throw new Error("Store does not provide deleteModel")},m.prototype.getList=function(){throw new Error("Store does not provide getList")},m.prototype.getViewList=function(t,e,r,n){function i(e,r){function n(){if(!s)return void o(t);for(t.addItem(),a=0;a<t.attributes.length;a++){var e=t.attributes[a];e.model==t.model&&t.set(e.name,l.get(e.name))}h=[];for(var r in t.view.relatedModels)t.view.relatedModels.hasOwnProperty(r)&&h.push(r);i()}function i(){if(!h.length)return s=l.moveNext(),void n();var e=h.shift(),r=t.view.relatedModels[e],a=l.get(r.id.name);r.model.set("id",a),c.getModel(r.model,function(e,r){if("undefined"!=typeof r)return void o(r);for(var n=0;n<t.attributes.length;n++){var s=t.attributes[n];s.model==e&&t.set(e.modelType+"."+s.name,e.get(s.name))}i()})}if(t.clear(),"undefined"!=typeof r)return void o(t,r);var s=l.moveFirst(),h=[];n()}var o,s,a,c=this;if("function"==typeof n?(o=n,s=r):o=r,!(t instanceof p))throw new Error("argument must be a List");if(!t.view)throw new Error("List is Model type use getList");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof o)throw new Error("callback required");var l=new p(t.model);s?this.getList(l,e,s,i):this.getList(l,e,i)},s.prototype.toString=function(){return"Text: '"+(this.contents||"")+"'"},s.prototype.get=function(){return this.contents},s.prototype.set=function(t){return this.contents=t,this._emitEvent("StateChange"),this.contents},s.prototype._emitEvent=function(t){var e;for(e in this._eventListeners)if(this._eventListeners.hasOwnProperty(e)){var r=this._eventListeners[e];(r.events.length&&"*"===r.events[0]||q(r.events,t))&&r.callback.call(this,t)}},s.prototype.onEvent=function(t,e){if(!(t instanceof Array)){if("string"!=typeof t)throw new Error("subscription string or array required");t=[t]}if("function"!=typeof e)throw new Error("callback is required");for(var r in t)if(t.hasOwnProperty(r)&&"*"!=t[r]&&!q(["StateChange"],t[r]))throw new Error("Unknown command event: "+t[r]);return this._eventListeners.push({events:t,callback:e}),this},s.prototype.offEvent=function(){this._eventListeners=[]},a.showLog=!1,a.messageHandlers={},a.setMessageHandler=function(t,e){a.messageHandlers[t]=e},a.hostMessageProcess=function(t,e){a.showLog&&console.log("Transport.hostMessageProcess "+JSON.stringify(t)),a.messageHandlers[t.type]?a.messageHandlers[t.type](t.contents,e):e(!0)},a.prototype.sendRaw=function(t){this.socket.send(t)},a.prototype.onRaw=function(t){this.rawCallBack=t},a.prototype.send=function(t,e){var r=this;if("undefined"==typeof t)throw new Error("message required");if(!(t instanceof i))throw new Error("parameter must be instance of Message");if("undefined"!=typeof e&&"function"!=typeof e)throw new Error("argument must a callback");return this.connected?void("undefined"!=typeof e?(a.showLog&&console.log("Transport emit "+JSON.stringify(t)),r.socket.emit("ackmessage",t,function(t){e.call(r,t)})):(a.showLog&&console.log("Transport send "+JSON.stringify(t)),r.socket.send(t))):void e.call(r,new i("Error","not connected"))},a.prototype.close=function(){if(!this.connected)throw new Error("not connected");this.socket.disconnect()},c.prototype.toString=function(){return this.primaryModel+" View"};var v=function(t){if(!1==this instanceof n)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a REPLInterface",t.vendor=t.vendor||null;var e,r=M(t,["name","description","vendor"]),i=[];for(e=0;e<r.length;e++)i.push("invalid property: "+r[e]);if(i.length>1)throw new Error("error creating Interface: multiple errors");if(i.length)throw new Error("error creating Interface: "+i[0]);this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,this.navStack=[];for(e in t)this[e]=t[e]};v.prototype=Object.create(n.prototype),v.prototype.toString=function(){return this.description},v.prototype.canMock=function(){return!0},v.prototype.doMock=function(){var t,e;if(this.mockPending=!1,!(this.mocks.length<1)){var r=this.mocks.shift();if("ok"==r.type)return void(this.okcallback?(t=this.okcallback,delete this.okcallback,t()):this.okPending=!0);if("yes"==r.type||"no"==r.type||"cancel"==r.type){switch(r.type){case"yes":e=!0;break;case"no":e=!1;break;case"cancel":e=void 0}return void(this.yesnocallback?(t=this.yesnocallback,delete this.yesnocallback,t(e)):(this.yesnoPending=!0,this.yesnoResponse=e))}if("ask"==r.type)return void(this.askcallback?(t=this.askcallback,delete this.askcallback,t(r.value)):(this.askPending=!0,this.askResponse=r.value));if("choose"==r.type)return void(this.choosecallback?(t=this.choosecallback,delete this.choosecallback,t(n.firstMatch(r.value,this.chooseChoices))):(this.choosePending=!0,this.chooseResponse=r.value));this.dispatch(r),this.mockPending=!0;var i=this;setTimeout(function(){i.doMock()},0)}},v.prototype.mockRequest=function(t){if(!(t instanceof Array||t instanceof o))throw new Error("missing request parameter");t instanceof Array||(t=[t]);var e;for(e=0;e<t.length;e++)if(!1==t[e]instanceof o)throw new Error("invalid request parameter");for(e=0;e<t.length;e++)this.mocks.push(t[e]);this.mockPending||this.doMock()},v.prototype.start=function(t,e,r){if(!(t instanceof w))throw new Error("Application required");if(!(e instanceof g))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callback required");this.application=t,this.presentation=e,this.startcallback=r,this.evaluateInput()},v.prototype.stop=function(t){if("function"!=typeof t)throw new Error("callback required")},v.prototype.dispatch=function(t,e){if(!1==t instanceof o)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");this.application&&this.application.dispatch(t)||this.startcallback&&this.startcallback(t)},v.prototype.notify=function(t){if(!1==t instanceof i)throw new Error("Message required");this._Output(t)},v.prototype.render=function(r,n,i){if(!1==r instanceof g)throw new Error("Presentation object required");if("string"!=typeof n)throw new Error("presentationMode required");if(!q(e.getPresentationModes(),n))throw new Error("Invalid presentationMode: "+n);if(i&&"function"!=typeof i)throw new Error("optional second argument must a commandRequest callback function");var o,s,a=r.get("contents"),c=0;switch(n){case"View":for(o=0;o<a.length;o++)a[o]instanceof t&&a[o].label.length>c&&(c=a[o].label.length);for(o=0;o<a.length;o++)s=a[o],s instanceof t?this._Output(R(s.label,c)+": "+s.value):this._Output(s);break;case"Edit":for(this.editPresentationContents=a.slice();this.editPresentationContents.length&&!(this.editPresentationContents[0]instanceof t);){var l=this.editPresentationContents.shift();l instanceof e||this._Output(l)}this.editPresentationContents.length&&this.editPresentationContents[0]instanceof t&&this._setPrompt(this.editPresentationContents[0].label+": "),this.editPresentationContents.length||delete this.editPresentationContents;break;default:throw new Error("presentationMode not handled: "+n)}},v.prototype.info=function(t){if(!t||"string"!=typeof t)throw new Error("text required");this._Output(t)},v.prototype.ok=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this._Output(t),this.okPending?(delete this.okPending,e()):this.okcallback=e},v.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.yesnoPrompt=t,this._setPrompt(this.yesnoPrompt),this.yesnoPending?(delete this.yesnoPending,e(this.yesnoResponse)):this.yesnocallback=e},v.prototype.ask=function(e,r,n){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("attribute or callback expected");if("function"!=typeof n)throw new Error("callback required");this.askPrompt=e,this._setPrompt(e),this.askPending?(delete this.askPending,n(this.askResponse)):this.askcallback=n},v.prototype.choose=function(t,e,r){if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.choosePrompt=t,this._Output(t);for(var i=0;i<e.length;i++)this._Output("  "+e[i]);this._setPrompt("Choice? "),this.choosePending?(delete this.choosePending,r(n.firstMatch(this.chooseResponse,e))):(this.choosecallback=r,this.chooseChoices=e)},v.prototype.evaluateInput=function(t){var e=this;void 0===t&&(t=""),this._evaluateInput(t),setTimeout(function(){var t=e.application?e.application.get("brand"):"?";!e.promptText&&e.application&&e.application.primaryInterface&&e._ShowNav(),e.promptText&&(t=e.promptText,delete e.promptText),e.capturePromptcallback&&e.capturePromptcallback(t)},10)},v.prototype._evaluateInput=function(r){var i,o,s,a=(""+r).toUpperCase();if(this.okcallback)return i=this.okcallback,delete this.okcallback,void i();if(this.yesnocallback)return"Y"==a||"YES"==a?(i=this.yesnocallback,delete this.yesnocallback,void i(!0)):"N"==a||"NO"==a?(i=this.yesnocallback,delete this.yesnocallback,void i(!1)):0===r.length?(i=this.yesnocallback,delete this.yesnocallback,void i()):(this._Output("yes or no response required"),void this._setPrompt(this.yesnoPrompt));if(this.askcallback)return i=this.askcallback,delete this.askcallback,void i(r);if(this.choosecallback){i=this.choosecallback;var c=n.firstMatch(r,this.chooseChoices);if(c)delete this.choosecallback,i(c);else if(r.length>0){for(this.application.info('"'+r+'" not valid'),this._Output(this.choosePrompt),o=0;o<this.chooseChoices.length;o++)this._Output("  "+this.chooseChoices[o]);this._setPrompt("Choice? ")}else delete this.choosecallback,i()}else{if(this.editPresentationContents){if(!(this.editPresentationContents.length&&this.editPresentationContents[0]instanceof t))throw this.editPresentationContents.length||delete this.editPresentationContents,new Error("editPresentationContents expected attribute");for(s=this.editPresentationContents.shift(),r.length&&(s.value=r);this.editPresentationContents.length&&!(this.editPresentationContents[0]instanceof t);)s=this.editPresentationContents.shift(),s instanceof e||this._Output(s);return this.editPresentationContents.length&&this.editPresentationContents[0]instanceof t&&this._setPrompt(this.editPresentationContents[0].label+": "),void(this.editPresentationContents.length||delete this.editPresentationContents)}if(this.presentation){var l=this.presentation.get("contents");if(this.navStack.length>0){var h=this.navStack[this.navStack.length-1];l=h.contents}for(o=0;o<l.length;o++){var u=l[o];if(u instanceof e){var p=u.name.toUpperCase();if(r.length&&I(p,a.length)==a){switch(u.type){case"Stub":this.info(u.description+" not available.");break;case"Menu":this.navStack.push(u);break;case"Presentation":u.presentationMode="Edit",u.execute(this);break;default:u.execute()}return}}}return void(r.length>0?this.application.info('"'+r+'" not valid'):this.navStack.pop())}this._Output("input ignored: "+r)}},v.prototype._ShowNav=function(){var t,r=this.application?this.application.get("brand"):"?",n=this.presentation.get("contents"),i="",o="",s="";if(this.navStack.length>0){var a=this.navStack[this.navStack.length-1];for(i=a.name.replace(/\s/g,"")+": ",n=a.contents,t=0;t<this.navStack.length;t++)r+=" / "+this.navStack[t].name.replace(/\s/g,"")}for(t=0;t<n.length;t++){var c=n[t];c instanceof e&&(o+=s+c.name.replace(/\s/g,""),s=", ")}this.application.info(i+o),this._setPrompt(r+">")},v.prototype.captureOutput=function(t){this.captureOutputcallback=t},v.prototype.capturePrompt=function(t){this.capturePromptcallback=t},v.prototype._setPrompt=function(t){this.promptText=t},v.prototype._Output=function(t){this.captureOutputcallback&&this.captureOutputcallback(t)};var w=function(e){if(!1==this instanceof w)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String(20)"})),e.attributes.push(new t({name:"brand",type:"String"})),e["interface"]&&(this.setInterface(e["interface"]),delete e["interface"]),f.call(this,e),this.modelType="Application",this.set("name","newApp"),this.set("brand","NEW APP")};w.prototype=Object.create(f.prototype),f._ModelConstructor.Application=w,w.prototype.start=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("error starting application: interface not set");if("function"!=typeof t)throw new Error("callback required");var e=this;this.startcallback=t,this.presentation||(this.presentation=new g),this.primaryInterface.start(e,this.presentation,function(t){"Command"==t.type?t.command.execute():e.startcallback&&e.startcallback(t)})},w.prototype.dispatch=function(t,e){if(!1==t instanceof o)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");return"Command"==t.type?(t.command.execute(),!0):!!this.startcallback&&(this.startcallback(t),!0)},w.prototype.setInterface=function(t){if(!1==t instanceof n)throw new Error("instance of Interface a required parameter");this.primaryInterface=t},w.prototype.getInterface=function(){return this.primaryInterface},w.prototype.setPresentation=function(t){if(!1==t instanceof g)throw new Error("instance of Presentation a required parameter");this.presentation=t},w.prototype.getPresentation=function(){return this.presentation},w.prototype.info=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.info(t)},w.prototype.done=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.done(t)},w.prototype.warn=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.warn(t)},w.prototype.err=function(t){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("text parameter required");this.primaryInterface.err(t)},w.prototype.ok=function(t,e){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.primaryInterface.ok(t,e)},w.prototype.yesno=function(t,e){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");this.primaryInterface.yesno(t,e)},w.prototype.ask=function(e,r,i){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!e||"string"!=typeof e)throw new Error("prompt required");if("function"==typeof r)return void this.primaryInterface.ask(e,new t({name:"default"}),r);if(!1==r instanceof t)throw new Error("attribute or callback expected");if("function"!=typeof i)throw new Error("callback required");this.primaryInterface.ask(e,r,i)},w.prototype.choose=function(t,e,r){if(!1==this.primaryInterface instanceof n)throw new Error("interface not set");if(!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");this.primaryInterface.choose(t,e,r)};var y=function(e){if(!1==this instanceof y)throw new Error("new operator required");if("string"==typeof e){var r=e;e={},e.contents=r}e=e||{},e.attributes||(e.attributes=[]);var n=e.logType||"Text",i=e.importance||"Info",o=e.contents||"(no text)";if(!q(["Text","Delta"],n))throw new Error("Unknown log type: "+n);"undefined"!=typeof e.logType&&delete e.logType,"undefined"!=typeof e.importance&&delete e.importance,"undefined"!=typeof e.contents&&delete e.contents,e.attributes.push(new t({name:"dateLogged",type:"Date",value:new Date})),e.attributes.push(new t({name:"logType",type:"String",value:n})),e.attributes.push(new t({name:"importance",type:"String",value:i})),"Delta"==n?e.attributes.push(new t({name:"contents",type:"Object",value:o})):e.attributes.push(new t({name:"contents",type:"String",value:o})),f.call(this,e),this.modelType="Log"};y.prototype=Object.create(f.prototype),f._ModelConstructor.Log=y,y.prototype.toString=function(){return"Delta"==this.get("logType")?this.get("importance")+": (delta)":this.get("importance")+": "+this.get("contents")};var g=function(e){if(!1==this instanceof g)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String"})),e.attributes.push(new t({name:"modelName",type:"String"})),e.attributes.push(new t({name:"contents",type:"Object",value:[]})),f.call(this,e),this.modelType="Presentation"};g.prototype=Object.create(f.prototype),f._ModelConstructor.Presentation=g,g.prototype.getObjectStateErrors=function(r){var n;if(this.validationErrors=f.prototype.getObjectStateErrors.call(this),!r&&0===this.validationErrors.length){var i=this.get("contents"),o=!1;if(i instanceof Array){for(n=0;n<i.length;n++)i[n]instanceof s||i[n]instanceof e||i[n]instanceof t||i[n]instanceof p||"string"==typeof i[n]||(o=!0);o&&this.validationErrors.push("contents elements must be Text, Command, Attribute, List or string")}else this.validationErrors.push("contents must be Array")}return this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},g.prototype.validate=function(e){function r(){l++,this.validationMessage&&(a=!0),c==l&&(a&&i.validationErrors.push("contents has validation errors"),n())}function n(){i.validationMessage=i.validationErrors.length>0?i.validationErrors[0]:"",e()}var i=this;if("function"!=typeof e)throw new Error("callback is required");this.getObjectStateErrors();var o;for(o in this._errorConditions)this._errorConditions.hasOwnProperty(o)&&this.validationErrors.push(this._errorConditions[o]);var s,a=!1,c=0,l=0,h=this.get("contents");for(h instanceof Array||(h=[]),s=0;s<h.length;s++)h[s]instanceof t&&c++;for(s=0;s<h.length;s++)h[s]instanceof t&&h[s].validate(r);h.length<1&&n()};var b=function(e){if(!1==this instanceof b)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]);var r=new t.ModelID(new E);e.attributes.push(new t({name:"userID",type:"Model",value:r})),e.attributes.push(new t({name:"dateStarted",type:"Date",value:new Date})),e.attributes.push(new t({name:"passCode",type:"String(20)"})),e.attributes.push(new t({name:"active",type:"Boolean"})),e.attributes.push(new t({name:"ipAddress",type:"String"})),f.call(this,e),this.modelType="Session",this.set("active",!1)};b.prototype=Object.create(f.prototype),f._ModelConstructor.Session=b,b.prototype.startSession=function(e,r,n,i,o){if(!1==e instanceof m)throw new Error("store required");if("string"!=typeof r)throw new Error("userName required");if("string"!=typeof n)throw new Error("password required");if("string"!=typeof i)throw new Error("ip required");if("function"!=typeof o)throw new Error("callback required");var s=this,a=new E;e.getList(new p(a),{name:r,password:n},function(r,n){if(n)return void o(n);if(1!=r.length())return void o(new Error("login not found"));for(var a="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=0;l<20;l++)a+=c.charAt(Math.floor(Math.random()*c.length));r.moveFirst(),r.model.set("id",r.get("id")),r.model.set("name",r.get("name")),s.set("userID",new t.ModelID(r.model)),s.set("active",!0),s.set("passCode",a),s.set("ipAddress",i),e.putModel(s,function(t,e){o(e,t)})})},b.prototype.resumeSession=function(t,e,r,n){if(!1==t instanceof m)throw new Error("store required");if("string"!=typeof e)throw new Error("ip required");if("string"!=typeof r)throw new Error("passCode required");if("function"!=typeof n)throw new Error("callback required");var i=this;t.getList(new p(i),{ipAddress:e,passCode:r},function(t,e){return e?void n(e):1!=t.length()?void n(new Error("session not resumed")):(t.moveFirst(),i.set("id",t.get("id")),i.set("userID",t.get("userID")),i.set("dateStarted",t.get("dateStarted")),i.set("passCode",t.get("passCode")),i.set("active",t.get("active")),i.set("ipAddress",t.get("ipAddress")),void n(e,i))})},b.prototype.endSession=function(t,e){if(!1==t instanceof m)throw new Error("store required");if("function"!=typeof e)throw new Error("callback required");this.get("active")&&this.get("id")||e(this),this.set("active",!1),t.putModel(this,function(t,r){e(r,t)})};var E=function(e){if(!1==this instanceof E)throw new Error("new operator required");e=e||{},e.attributes||(e.attributes=[]),e.attributes.push(new t({name:"name",type:"String(20)"})),e.attributes.push(new t({name:"active",type:"Boolean"})),e.attributes.push(new t({name:"password",type:"String(20)"})),e.attributes.push(new t({name:"firstName",type:"String(35)"})),e.attributes.push(new t({name:"lastName",type:"String(35)"})),e.attributes.push(new t({name:"email",type:"String(20)"})),f.call(this,e),this.modelType="User",this.set("active",!1)};E.prototype=Object.create(f.prototype),f._ModelConstructor.User=E,l.prototype=Object.create(f.prototype),f._ModelConstructor.Workspace=l;var k=function(t){if(!1==this instanceof k)throw new Error("new operator required");t=t||{},this.storeType=t.storeType||"MemoryStore",this.name=t.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0},this.data=[],this.idCounter=0;for(var e=M(t,["name","storeType"]),r=[],n=0;n<e.length;n++)r.push("invalid property: "+e[n]);if(r.length>1)throw new Error("error creating Store: multiple errors");if(r.length)throw new Error("error creating Store: "+r[0])};k.prototype=Object.create(m.prototype),k.prototype.getModel=function(t,e){var r,n;if(!(t instanceof f))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if(!t.attributes[0].value)throw new Error("ID not set");if("function"!=typeof e)throw new Error("callback required");var i=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(i=r);if(i<0)return void e(t,new Error("model not found in store"));var o=t.get("id"),s=this.data[i][1],a=-1;for(r=0;a<0&&r<s.length;r++)s[r][0]==o&&(a=r);if(a<0)return void e(t,new Error("id not found in store"));var c=s[a][1];for(n in t.attributes)t.attributes[n].value=c[t.attributes[n].name];e(t,void 0)},k.prototype.putModel=function(t,e){var r,n,i,o,s,a,c;if(!(t instanceof f))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");if(i=t.get("ID")){for(o=-1,r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(o=r);if(o<0)return void e(t,new Error("model not found in store"));var l=-1;i=t.get("id");var h=this.data[o][1];for(r=0;l<0&&r<h.length;r++)h[r][0]==i&&(l=r);if(l<0)return void e(t,new Error("id not found in store"));s={};for(n in t.attributes)a=t.attributes[n].name,c=t.attributes[n].value,s[a]=c;h[l][1]=s,e(t,void 0)}else{for(o=-1,r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(o=r);o<0&&(this.data.push([t.modelType,[]]),o=this.data.length-1);var u=++this.idCounter;t.set("id",u),s={};for(n in t.attributes)a=t.attributes[n].name,c=t.attributes[n].value,s[a]=c;this.data[o][1].push([u,s]),e(t,void 0)}},k.prototype.deleteModel=function(t,e){var r,n;if(!(t instanceof f))throw new Error("argument must be a Model");if(t.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof e)throw new Error("callback required");var i=-1;for(r=0;r<this.data.length;r++)this.data[r][0]==t.modelType&&(i=r);if(i<0)return void e(t,new Error("model not found in store"));var o=-1,s=t.get("id"),a=this.data[i][1];for(r=0;o<0&&r<a.length;r++)a[r][0]==s&&(o=r);if(o<0)return void e(t,new Error("id not found in store"));var c=a.splice(o,1)[0][1];for(n in t.attributes)"id"==t.attributes[n].name?t.attributes[n].value=void 0:t.attributes[n].value=c[t.attributes[n].name];e(t,void 0)},k.prototype.getList=function(t,e,r,n){var i,o,s;if("function"==typeof n?(i=n,o=r):i=r,!(t instanceof p))throw new Error("argument must be a List");if(t.view)throw new Error("List is View type use getViewList");if(!(e instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof i)throw new Error("callback required");var a=-1;for(s=0;s<this.data.length;s++)this.data[s][0]==t.model.modelType&&(a=s);if(a<0)return void i(t);t.clear();var c=this.data[a][1];for(s=0;s<c.length;s++){var l=!0;for(var h in e)e.hasOwnProperty(h)&&(e[h]instanceof RegExp?e[h].test(c[s][1][h])||(l=!1):e[h]!=c[s][1][h]&&(l=!1));if(l){var u=[];for(var f in c[s][1])u.push(c[s][1][f]);t._items.push(u)}}t._itemIndex=t._items.length-1,o&&t.sort(o),i(t)};var q=function(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},P=function(t){function e(){}if(null===t)throw new TypeError;if(Object.create)return Object.create(t);var r=typeof t;if("object"!==r&&"function"!=typeof r)throw new TypeError;return e.prototype=t,new e},M=function(t,e){var r=[];for(var n in t)t.hasOwnProperty(n)&&(q(e,n)||r.push(n));return r},_=function(t){return f._ModelConstructor[t]||f},C=function(t){var e=_(t);return new e},x=function(t,e){if("string"!=typeof t)throw new Error("expected CPON string");void 0===e&&(e={});var r=t.indexOf("^");if(r<0)throw new Error("caret (^) not found in garden");var n=I(t,r),i=t.substring(r+1),o=i.indexOf("|");return o>-1&&(e=x(i.substring(o+1),e),i=I(i,o)),e[n]=i,e},I=function(t,e){return t.substring(0,e)},S=function(t,e){return t.substring(t.length-e,t.length)},T=function(t,e){var r=(t.length-e)/2;return t.substring(r,r+e)},O=function(t){return t.replace(/^\s+|\s+$/g,"")},L=function(t){return t.replace(/^\s+/,"")},A=function(t){return t.replace(/\s+$/,"")},R=function(t,e,r){r=r||" ";var n=""+t;if(n.length>e)return I(n,e);for(;n.length<e;)n=r+n;return n},D=function(t,e,r){r=r||" ";var n=""+t;if(n.length>e)return S(n,e);for(;n.length<e;)n+=r;return n},N=function(t,e,r){r=r||" ";var n=""+t,i=e-n.length;if(n.length>e)return T(n,e);var o=n.length+Math.floor(i/2);return n=R(n,o,r),n=D(n,e,r)};u.INTERFACE=u.INTERFACE||{},u.INTERFACE.ONSEN2=function(){return{version:"0.1.1",Onsen2Interface:H}};var H=function(t){if(!1==this instanceof n)throw new Error("new operator required");t=t||{},t.name=t.name||"(unnamed)",t.description=t.description||"a Onsen2Interface",t.vendor=t.vendor||null;var e,r=M(t,["name","description","vendor"]),i=[];for(e=0;e<r.length;e++)i.push("invalid property: "+r[e]);if(i.length>1)throw new Error("error creating Interface: multiple errors");if(i.length)throw new Error("error creating Interface: "+i[0]);this.startcallback=null,this.stopcallback=null,this.mocks=[],this.mockPending=!1,this.doc={};for(e in t)this[e]=t[e]};H.prototype=Object.create(n.prototype),H.prototype.canMock=function(){return!!this.vendor},H.prototype.start=function(t,e,r){if(!(t instanceof w))throw new Error("Application required");if(!(e instanceof g))throw new Error("presentation required");if("function"!=typeof r)throw new Error("callback required");if(this.application=t,this.presentation=e,this.startcallback=r,!this.vendor)throw new Error("Error initializing Onsen2");try{H._bs||(H._bs=new this.vendor)}catch(n){throw new Error("Error initializing Onsen2: "+n)}this.htmlPanels(),this.htmlDialog(),this.presentation.get("contents").length&&this.htmlNavigation()},H.prototype.dispatch=function(t,e){if(!1==t instanceof o)throw new Error("Request required");if(e&&"function"!=typeof e)throw new Error("response callback is not a function");var r=!1;try{this.application&&("Command"==t.type&&"Presentation"==t.command.type?(t.command.execute(this),r=!0):r=this.application.dispatch(t)),!r&&this.startcallback&&this.startcallback(t)}catch(n){this.startcallback&&this.startcallback(n)}},H.prototype.render=function(t,r){if(!1==t instanceof e)throw new Error("Command object required");this.activatePanel(t)},H.addEle=function(t,e,r,n){var i=document.createElement(e);if(r&&r.length&&(i.className=r),n)for(var o in n)n.hasOwnProperty(o)&&i.setAttribute(o,n[o]);return t.appendChild(i),i},H.addTopEle=function(t,e,r,n){var i=document.createElement(e);if(r&&r.length&&(i.className=r),n)for(var o in n)n.hasOwnProperty(o)&&i.setAttribute(o,n[o]);return t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i),i},H.prototype.htmlNavigation=function(){var t=this;t.navCommands=[];const e=H.addEle;this.doc.sideMenu=e(this.doc.mainContainer,"ons-splitter-side",void 0,{id:"menu",swipeable:"",collapse:"",width:"220px"}),this.doc.ssPage=e(this.doc.sideMenu,"ons-page"),this.doc.ssList=e(this.doc.ssPage,"ons-list"),this.doc.ssNav=e(this.doc.mainContainer,"ons-navigator",void 0,{id:"navigator"}),this.doc.ssNavPage=e(this.doc.ssNav,"ons-page"),this.refreshNavigation()},H.prototype.refreshNavigation=function(){const t=H.addEle;this.doc.ssList.innerHTML="";const e=this.presentation.get("contents");for(var r in e)if(e.hasOwnProperty(r))if("Menu"===e[r].type){var n=this.addNavBarListMenu(this.doc.ssList,e[r]),i=e[r].contents;for(var o in i)i.hasOwnProperty(o)&&this.addNavBarListItem(n,i[o])}else"-"===e[r]?t(this.doc.ssList,"HR"):this.addNavigationItem(this.doc.ssList,e[r])},H.prototype.addNavigationItem=function(t,e){var r=this,n=r.navIndex(e);const i=H.addEle;var o=i(this.doc.ssList,"ons-list-item",void 0,{modifier:"nodivider",onclick:"app.primaryInterface.nav("+n+")"}),s='<ons-icon style="opacity: 0.25" fixed-width class="list-item__icon" icon="fa-minus" size="16px"></ons-icon>';e.icon&&"fa"===I(e.icon,2)&&(s='<ons-icon fixed-width class="list-item__icon" icon="'+e.icon+'" size="16px"></ons-icon>'),o.innerHTML='<div class="left">'+s+e.name+"</div>"},H.prototype.addNavBarListItem=function(t,e){var r=this;const n=H.addEle;if("string"!=typeof e){var i=r.navIndex(e),o=n(t,"ons-list-item",void 0,{modifier:"nodivider",onclick:"app.primaryInterface.nav("+i+")"}),s='<ons-icon style="opacity: 0.25" fixed-width class="list-item__icon" icon="fa-minus" size="16px"></ons-icon>';e.icon&&"fa"===I(e.icon,2)&&(s='<ons-icon fixed-width class="list-item__icon" icon="'+e.icon+'" size="16px"></ons-icon>'),o.innerHTML='<div class="left">'+s+e.name+"</div>"}},H.prototype.addNavBarListMenu=function(t,e){const r=H.addEle;var n=r(this.doc.ssList,"ons-list-item",void 0,{expandable:"",modifier:"nodivider"}),i='<ons-icon style="opacity: 0.25" fixed-width class="list-item__icon" icon="fa-bars" size="16px"></ons-icon>';
return e.icon&&"fa"===I(e.icon,2)&&(i='<ons-icon fixed-width class="list-item__icon" icon="'+e.icon+'" size="16px"></ons-icon>'),n.innerHTML='<div class="left">'+i+e.name+"</div>",r(n,"div","expandable-content")},H.prototype.nav=function(t){var e=this,r=e.navCommands[t];app.primaryInterface.dispatch(new o({type:"Command",command:r}))},H.prototype.navIndex=function(t){var e=this,r=e.navCommands.push(t)-1;return r},H.prototype.htmlPanels=function(){this.doc.mainContainer=H.addEle(document.body,"ons-splitter")},H.prototype.activatePanel=function(t){var e=this,r=t.contents,n=r.get("name")||t.name;"undefined"==typeof e.panels&&(e.panels=[]);for(var i,o=0;"undefined"==typeof i&&o<e.panels.length;o++)n===e.panels[o].name&&(i=e.panels[o]);"undefined"==typeof i&&(i={name:n,textListeners:[],attributeListeners:[],id:this.panels.length},this.panels.push(i)),e.renderPanelBody(i,t)},H.prototype.renderPanelBody=function(r,n){function i(){function i(t,e){switch(E){case"-":h(t,"ons-list-header").innerHTML="<br>";break;case">":h(t,"ons-list-header").innerHTML="indent = true;",y=!0;break;case"<":h(t,"ons-list-header").innerHTML="indent = false;",y=!1;break;default:h(t,"ons-list-item").innerHTML=marked(e)}}function a(t,e){var n=h(h(t,"ons-list-item"),"div","card__content");n.innerHTML=marked(e.get()),e.onEvent("StateChange",function(){n.innerHTML=marked(e.get())}),r.textListeners.push(e)}function c(t,e,n){var i,o,s,a,c,l,u,p;switch(n+e.type){case"ViewDate":c=h(t,"ons-list-item","input-items"),s=h(c,"div","left",{style:"width: 96px",align:"right"}),s.innerHTML='<label style="width: 96px; font-size:90%">'+e.label+"</label>&nbsp;&nbsp;",o=h(c,"label","center"),e.value&&(o.innerHTML=1+e.value.getMonth()+"/"+e.value.getDate()+"/"+e.value.getFullYear());break;case"ViewNumber":case"ViewString":c=h(t,"ons-list-item","input-items"),s=h(c,"div","left",{style:"width: 96px",align:"right"}),s.innerHTML='<label style="width: 96px; font-size:90%">'+e.label+"</label>&nbsp;&nbsp;",o=h(c,"label","center"),e.value&&(o.innerHTML=e.value);break;case"EditBoolean":case"ViewBoolean":c=h(t,"ons-list-item","input-items"),s=h(c,"div","left",{style:"width: 96px",align:"right"}),s.innerHTML='<label style="width: 96px; font-size:90%">'+e.label+"</label>&nbsp;&nbsp;",o=h(c,"div","center"),e.value?o.innerHTML="<ons-switch "+("Edit"===n?"":"disabled")+' checked="true"></ons-switch>':o.innerHTML="<ons-switch "+("Edit"===n?"":"disabled")+"></ons-switch>";break;case"EditString":c=h(t,"ons-list-item","input-items"),s=h(c,"div","left",{style:"width: 96px",align:"right"}),s.innerHTML='<label style="width: 96px; font-size:90%">'+e.label+"</label>&nbsp;&nbsp;",o=h(c,"label","center"),i=h(o,"ons-input",void 0,{id:v,maxLength:e.size,type:e.hint.password?"password":"text"}),e.placeHolder&&i.setAttribute("placeHolder",e.placeHolder),e.value&&(i.value=e.value),e.quickPick&&(a=h(c,"div","right"),l=h(a,"ons-toolbar-button"),l.innerHTML='<ons-icon icon="fa-caret-down"></ons-icon>',l.addEventListener("click",function(t){for(p=[],u=e.quickPick,m=0;m<u.length;m++)p.push(u[m]);p.push({label:"Cancel",icon:"md-close"}),ons.openActionSheet({title:e.label,cancelable:!0,buttons:p}).then(function(t){t<u.length&&(i.value=u[t])})}));break;case"EditNumber":c=h(t,"ons-list-item","input-items"),s=h(c,"div","left",{style:"width: 96px",align:"right"}),s.innerHTML='<label style="width: 96px; font-size:90%">'+e.label+"</label>&nbsp;&nbsp;",o=h(c,"label","center"),i=h(o,"ons-input",void 0,{id:v,maxLength:e.size,type:"number"}),e.placeHolder&&i.setAttribute("placeHolder",e.placeHolder),e.value&&(i.value=e.value);break;case"EditDate":c=h(t,"ons-list-item","input-items"),s=h(c,"div","left",{style:"width: 96px",align:"right"}),s.innerHTML='<label style="width: 96px; font-size:90%">'+e.label+"</label>&nbsp;&nbsp;",o=h(c,"label","center"),i=h(o,"ons-input",void 0,{id:v,type:"date",style:"min-width:95%"}),e.placeHolder&&i.setAttribute("placeHolder",e.placeHolder),e.value&&(i.value=e.value);break;default:c=h(t,"ons-list-item","input-items"),s=h(c,"div","left",{style:"width: 96px",align:"right"}),s.innerHTML='<label style="width: 96px; font-size:90%">'+e.label+"</label>&nbsp;&nbsp;",o=h(c,"label","center"),o.innerHTML="default: "+n+e.type}e.onEvent("Validate",function(){e._validationDone=!0}),e.onEvent("StateChange",function(){switch(n+e.type){case"EditBoolean":case"ViewBoolean":e.value?o.innerHTML="<ons-switch "+("Edit"===n?"":"disabled")+' checked="true"></ons-switch>':o.innerHTML="<ons-switch "+("Edit"===n?"":"disabled")+"></ons-switch>";break;case"EditDate":i.value=e.value;break;case"EditNumber":i.value=e.value?e.value:0;break;case"EditString":i.value=e.value?""+e.value:"";break;case"ViewDate":o.innerHTML=e.value?""+(1+e.value.getMonth())+"/"+e.value.getDate()+"/"+e.value.getFullYear():"";break;default:o.innerHTML=e.value}}),r.attributeListeners.push(e)}function u(t,e,r){for(var n=e.moveFirst();n;){var i=h(t,"ons-card"),o=h(i,"div","content"),s=h(o,"ons-list",void 0,{modifier:"noborder"}),a=e.model.attributes[0];for(i.dataset.id=e.get(a.name),i.addEventListener("click",function(t){console.log("event.currentTarget: "+t.currentTarget),e.pickKludge&&e.pickKludge(t.currentTarget.dataset.id)}),m=1;m<e.model.attributes.length;m++){var c=e.model.attributes[m];if(void 0===c.hidden){var l=e.get(c.name),u=""+l;switch(c.type){case"Date":u=l?I(l.toISOString(),10):"&nbsp;";break;case"Boolean":u=l?'<div style="font-weight:bold; font-size: larger"></div>':'<div style="font-weight:bold; font-size: larger"></div>'}var p=h(s,"ons-row"),f='<ons-col class="list-card-col" align="right" width="25%"><b>'+c.label+"</b></ons-col>",d='<ons-col width="2.5%"></ons-col>',v='<ons-col class="list-card-col">'+u+"</ons-col>";p.innerHTML=f+d+v}}n=e.moveNext()}return;var n,a,c,l}function f(t,e){var r;w||(y=!1,y?(r=h(t,"ons-list-item","input-items"),w=h(r,"div","right")):(r=h(t,"section",void 0,{style:"padding: 16px"}),w=h(r,"div",void 0,{style:"text-align:left"})));var n=h(w,"ons-button",void 0,{id:v,modifier:"large",style:"margin: 8px;fixed-width: 100px"});return n.innerText=e.name,void n.addEventListener("click",function(t){l.dispatch(new o({type:"Command",command:e}))});var n}var d,m,v,w,y=!1,g=h(document.getElementById("pc"+r.id),"ons-list"),b=n.contents.get("contents"),E=null;for(d=0;d<b.length;d++)E instanceof e||(w=void 0),v="id"+r.id+"_"+d,E=b[d],"string"==typeof E?i(g,E):E instanceof s?a(g,E):E instanceof t?c(g,E,n.presentationMode):E instanceof p?u(g,E,n.theme):E instanceof e&&f(g,E)}console.log("Onsen2Interface.prototype.renderPanelBody");var a,c,l=this,h=H.addEle;if(!r.template){var u=u="pc"+r.id;r.template=document.createElement("template"),r.template.id="panel"+r.id+".html",r.template.innerHTML='<ons-page id="pg'+r.id+'"><ons-toolbar id="tb'+r.id+'"><div class="left"><ons-toolbar-button onclick="document.querySelector(\'#menu\').open()"><ons-icon icon="md-menu"></ons-icon></ons-toolbar-button></div><div class="center">'+r.name+'</div></ons-toolbar><div id = "'+u+'"></div></ons-page>',document.body.appendChild(r.template)}for(a=0;a<r.textListeners.length;a++)c=r.textListeners[a],c.offEvent();for(a=0;a<r.attributeListeners.length;a++)c=r.attributeListeners[a],c.offEvent();document.querySelector("#menu").close(),document.querySelector("#navigator").resetToPage("panel"+r.id+".html").then(function(){i()})},H.prototype.htmlDialog=function(){H.addEle},H.prototype.info=function(t){ons.notification.toast("<b><u>Information</b></u></br>"+t,{timeout:2e3})},H.prototype.done=function(t){ons.notification.toast("<b><u>Done</b></u></br>"+t,{timeout:2e3})},H.prototype.warn=function(t){ons.notification.toast("<b><u>WARNING</b></u></br>"+t,{timeout:2e3})},H.prototype.err=function(t){ons.notification.toast("<b><u>ERROR</b></u></br>"+t,{timeout:2e3})},H.prototype.ok=function(t,e){ons.notification.alert(t,{callback:e})},H.prototype.yesno=function(t,e){if(!t||"string"!=typeof t)throw new Error("prompt required");if("function"!=typeof e)throw new Error("callback required");ons.notification.confirm(t,{buttonLabels:["No","Yes"]}).then(function(t){e(t)})},H.prototype.ask=function(e,r,n){if(!e||"string"!=typeof e)throw new Error("prompt required");if(!1==r instanceof t)throw new Error("attribute or callback expected");if("function"!=typeof n)throw new Error("callback required");ons.notification.prompt(e,{defaultValue:r.value}).then(function(t){n(t)})},H.prototype.choose=function(t,e,r){if(console.log("choose: "+t),!t||"string"!=typeof t)throw new Error("prompt required");if(!1==e instanceof Array)throw new Error("choices array required");if(!e.length)throw new Error("choices array empty");if("function"!=typeof r)throw new Error("callback required");var n=[];for(var i in e)n.push(e[i]);var o=n.push({label:"Cancel",icon:"md-close"})-1,s={title:t,cancelable:!0,buttons:n};ons.openActionSheet(s).then(function(t){t<0||t==o?r():r(n[t])})},"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=u),exports.TGI=u):h.TGI=u}).call(this);